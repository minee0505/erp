# [TIL] 2026-02-06

## ERP 시스템 설계 표준 및 비즈니스 로직(SP) 구현 심화

## 1. DB 필드 명명 규칙 및 마스터-디테일 관계 (1:N)

### 문제 상황
* 테이블마다 유사한 필드명(`Seq`, `Unit`, `Kind`)이 혼용되는 이유와 견적내부코드/순번을 분리 관리하는 목적 파악.

### 원인 분석
* 데이터의 정체성을 직관적으로 파악하고, 대규모 시스템에서 데이터 무결성을 유지하기 위한 설계 표준 이해 필요.

### 해결 및 배운 점
* **필드명별 상세 의미:**
    * **Seq (Sequence):** 단순히 등록된 **순서나 일련번호**. 주로 PK나 단순 식별용으로 활용.
    * **Unit (Unit):** 특정 **그룹이나 구성 단위**에 속할 때 사용. 물류나 자재 관리 단위에서 활용.
    * **Kind (Kind/Type):** **성질이나 카테고리**를 구분할 때 사용 (예: 메탈릭/매트, 실내용/실외용).
* **견적내부코드와 순번 분리의 이유:**
    * **견적내부코드 (Grouping):** 문서 전체를 대표하는 고유 번호 (비유: 아파트 동/호수).
    * **견적순번내부코드 (Ordering):** 문서 내 각 줄(Line)의 식별 번호 (비유: 그 집의 가족 구성원 번호).
    * **결론:** 두 코드가 조합되어야 특정 문서 내의 특정 품목을 정확히 추적/수정/삭제할 수 있음.

---

## 2. 데이터 타입과 인덱스의 물리적 저장 구조

### 문제 상황
* 정확한 수치 계산을 위한 `DECIMAL` 타입의 구조와 조회 성능 최적화를 위한 `CLUSTERED` 인덱스의 원리 파악.

### 원인 분석
* 금융 데이터의 오차 방지 및 대용량 데이터 조회 시 디스크 I/O 효율성 극대화 원리 이해 필요.

### 해결 및 배운 점
* **DECIMAL(P, S)의 정밀도:**
    * **P (Precision):** 소수점을 포함한 **전체 자릿수**.
    * **S (Scale):** 소수점 아래 **소수 자릿수**.
    * **특징:** 고정 소수점을 사용하여 환율, 금액 등 오차가 없어야 하는 데이터 저장에 필수적임.
* **CLUSTERED 인덱스의 물리적 의미:**
    * **정의:** 데이터를 지정된 컬럼 순서로 **디스크 상에 물리적으로 정렬**하여 저장 (테이블당 1개만 가능).
    * **특징:** 국어사전과 같아서 인덱스 자체가 곧 데이터 페이지임.
    * **효과:** 범위(Range) 조회 및 정렬 성능이 극대화됨.

---

## 3. SQL 쿼리 최적화 및 프로시저(SP) 작성 원칙

### 문제 상황
* `WITH(NOLOCK)`의 필요성과 SP 수정 시 `DROP`을 피해야 하는 기술적 이유 확인.

### 원인 분석
* 다중 사용자 환경에서의 잠금(Lock) 충돌 방지 및 운영 시스템의 보안/권한 관리 체계 이해 필요.

### 해결 및 배운 점
* **WITH(NOLOCK)의 역할:**
    * 조회 시 다른 작업의 잠금을 무시하고 즉시 읽어오는 **'속도 향상 치트키'**.
    * **장점:** 데드락 방지 및 조회 성능 향상.
    * **주의:** 수정 중인 미완성 데이터를 읽을 위험(Dirty Read)이 있음.
* **SP 수정 원칙 (ALTER vs DROP):**
    * **DROP 금지:** 삭제 시 해당 SP에 부여된 모든 실행 권한(`GRANT`)이 함께 증발하여 운영 장애 유발.
    * **ALTER 사용:** 기존 객체를 유지하며 내용만 리모델링하여 보안 권한과 히스토리를 보존함.
* **PK의 Input/Output 방향성:**
    * **Input:** 특정 데이터를 찾기 위한 **조회 열쇠**.
    * **Output:** 찾은 번호를 화면에 표시하거나 다음 작업을 위해 유지하는 **이름표**.

---

## 4. 비즈니스 서비스 워크플로우(Workflow) 구현

### 문제 상황
* 저장 프로세스 중 '복사' 단계의 역할과 개발 툴의 오류 처리 아이콘 의미 파악.

### 원인 분석
* 마스터(부모)에서 채번된 PK를 디테일(자식)에 상속시키는 프로세스 및 프레임워크 규칙 이해 필요.

### 해결 및 배운 점
* **복사(Copy) 프로세스:** 마스터에서 생성된 새 번호(`EstimateSeq`)를 디테일 블록의 모든 행에 상속시켜 부모-자식 관계를 형성함.
* **Workflow 아이콘:** **아래 화살표(↓)**는 오류(경고)가 있어도 다음 단계로 진행하며, 결과값을 화면에 반영하라는 의미.
* **UI 속성 규칙:** `Name` 속성은 변수명 역할을 하므로 **공백(띄어쓰기)이 절대 금지**됨 (예: `FrmEduEstimate_QEdu217`).

---

## 5. 오늘의 회고 (Action Plan)

단순한 코드 작성을 넘어 ERP 시스템의 물리적 설계 철학과 데이터 무결성을 지키는 법을 심도 있게 파헤친 하루였다. 특히 운영 환경에서 `DROP`이 얼마나 위험한지, 그리고 왜 `ALTER`로 프로답게 관리해야 하는지 깨달은 것이 큰 수확이다.

**[Action Plan]**
1. **데이터 검증:** 수정 완료한 `QEdu217` 프로시저로 실제 저장 시 마스터-디테일 간 `EstimateSeq` 상속 여부 DB에서 직접 확인.
2. **문서화 표준:** 모든 SP 수정 시 이력을 명사형으로 기록(`DROP → ALTER 구문 변경` 등)하는 습관 유지.
3. **로직 확장:** 오늘 학습한 `WorkingTag` 분기 처리를 응용하여 삭제(D) 및 수정(U) 로직 직접 설계해보기.
